# Weblogic T3 反序列化漏洞-CVE-2016-3510

## 漏洞原理

该漏洞是CVE-2015-4852漏洞补丁的绕过。把恶意的序列化数据封装到weblogic.corba.utils.MarshalledObject类的objBytes属性中，MarshalledObject类不在CVE-2015-4852漏洞黑名单里面，可正常反序列化该类，再通过MarshalledObject类的readResolve方法调用readObject反序列化objBytes属性中序列化数据。

## 漏洞复现

工具：https://github.com/5up3rc/weblogic_cmd

在Main函数中启用

public static String TYPE = "marshall";

![image-20221206183709484](D:/Desktop/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/Weblogic/Assets/Weblogic%20T3%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3-CVE-2016-3510/image-20221206183709484.png)  

配置Main命令行参数

-H "192.168.8.139" -C "touch /tmp/cve-2016-3510" -B -os linux

![image-20221206183758441](D:/Desktop/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/Weblogic/Assets/Weblogic%20T3%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3-CVE-2016-3510/image-20221206183758441.png)  

运行Main

![image-20221206183828645](D:/Desktop/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/Weblogic/Assets/Weblogic%20T3%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3-CVE-2016-3510/image-20221206183828645.png)  

成功执行命令

![image-20221206183845883](D:/Desktop/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/Weblogic/Assets/Weblogic%20T3%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3-CVE-2016-3510/image-20221206183845883.png) 

## 漏洞分析

在weblogic.corba.utils.MarshalledObject#readResolve方法内打断点，发送payload即可触发断点

![image-20221206184510212](D:/Desktop/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/Weblogic/Assets/Weblogic%20T3%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-3-CVE-2016-3510/image-20221206184510212.png) 

调用栈

```
readObject:363, ObjectInputStream (java.io) [2]
readResolve:58, MarshalledObject (weblogic.corba.utils)
invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
invoke:57, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:601, Method (java.lang.reflect)
invokeReadResolve:1091, ObjectStreamClass (java.io)
readOrdinaryObject:1805, ObjectInputStream (java.io)
readObject0:1348, ObjectInputStream (java.io)
readObject:370, ObjectInputStream (java.io) [1]
readObject:66, InboundMsgAbbrev (weblogic.rjvm)
read:38, InboundMsgAbbrev (weblogic.rjvm)
readMsgAbbrevs:283, MsgAbbrevJVMConnection (weblogic.rjvm)
init:213, MsgAbbrevInputStream (weblogic.rjvm)
dispatch:498, MsgAbbrevJVMConnection (weblogic.rjvm)
dispatch:330, MuxableSocketT3 (weblogic.rjvm.t3)
dispatch:387, BaseAbstractMuxableSocket (weblogic.socket)
readReadySocketOnce:967, SocketMuxer (weblogic.socket)
readReadySocket:899, SocketMuxer (weblogic.socket)
processSockets:130, PosixSocketMuxer (weblogic.socket)
run:29, SocketReaderRequest (weblogic.socket)
execute:42, SocketReaderRequest (weblogic.socket)
execute:145, ExecuteThread (weblogic.kernel)
run:117, ExecuteThread (weblogic.kernel)
```



## 参考

https://xz.aliyun.com/t/8443#toc-4

https://github.com/zhzhdoai/Weblogic_Vuln

https://xz.aliyun.com/t/8443#toc-6

https://blog.csdn.net/qq_53264525/article/details/122743342

https://xz.aliyun.com/t/8529#toc-0

https://xz.aliyun.com/t/8529#toc-5